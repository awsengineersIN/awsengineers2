# During data fetching, create both display data and metadata
def get_ebs_volumes(region, account_id, account_name, role_name):
    volumes = []
    metadata = {}  # Volume ID -> {account_id, region, account_name}
    
    # ... fetch volumes ...
    
    for vol in volumes_response['Volumes']:
        volume_id = vol['VolumeId']
        
        # Display data (what users see)
        volumes.append({
            'Name': get_tag_value(vol, 'Name'),
            'Volume ID': volume_id,
            'Size': vol['Size'],
            'Type': vol['VolumeType'],
            'State': vol['State'],
            # ... other visible fields ...
        })
        
        # Metadata (for navigation)
        metadata[volume_id] = {
            'account_id': account_id,
            'account_name': account_name,
            'region': region
        }
    
    return volumes, metadata

# Store both in session state
st.session_state.ebs_data = volumes
st.session_state.ebs_metadata = metadata  # Lookup dict

# Later, when navigating:
selected_row = df.iloc[selected_index]
volume_id = selected_row['Volume ID']

# Lookup metadata
meta = st.session_state.ebs_metadata[volume_id]

st.session_state.selected_volume_id = volume_id
st.session_state.selected_account_id = meta['account_id']      # ✅ From metadata
st.session_state.selected_region = meta['region']               # ✅ From metadata
st.session_state.selected_account_name = meta['account_name']

st.switch_page("pages/EBS_Volume_Details.py")
